# StarCode Snippets 同步功能测试文档

## 测试环境准备

### 基础环境
- VSCode 版本：1.15.0 及以上
- StarCode Snippets 扩展：最新版本
- 网络连接：稳定的互联网连接
- 测试设备：至少2台不同设备（用于多设备同步测试）

### 测试平台账号准备
- GitHub 账号 + Personal Access Token
- GitLab 账号 + Personal Access Token  
- Gitee 账号 + Personal Access Token
- SSH 密钥对（用于SSH认证测试）

### 测试数据准备
- 测试代码片段：包含不同编程语言的代码片段
- 测试目录结构：多层级目录结构
- 特殊字符数据：包含特殊字符的代码片段名称和内容
- 大量数据：用于性能测试的大批量代码片段

---

## 测试用例分类

### 1. 配置管理测试

#### 1.1 新建平台配置测试
**测试目标**: 验证各平台配置的创建功能

**测试步骤**:
1. 打开StarCode Snippets设置页面
2. 点击"添加新配置"
3. 选择平台类型（GitHub/GitLab/Gitee）
4. 填写必要信息：
   - 配置名称：`测试配置_GitHub`
   - 仓库URL：`https://github.com/username/test-snippets.git`
   - 访问令牌：有效的Personal Access Token
   - 认证方式：Token认证
5. 保存配置

**预期结果**:
- 配置成功保存
- 配置列表中显示新配置
- 状态显示为"未激活"

**测试数据**:
```
GitHub: https://github.com/test-user/snippets-test.git
GitLab: https://gitlab.com/test-user/snippets-test.git  
Gitee: https://gitee.com/test-user/snippets-test.git
```

#### 1.2 SSH认证配置测试
**测试目标**: 验证SSH密钥认证配置

**测试步骤**:
1. 准备SSH密钥对
2. 在平台上添加公钥
3. 在扩展中配置SSH认证：
   - 选择"SSH认证"
   - 设置SSH密钥路径
   - 配置仓库SSH URL
4. 测试连接

**预期结果**:
- SSH认证配置成功
- 连接测试通过

#### 1.3 配置验证测试
**测试目标**: 验证配置信息的有效性检查

**测试用例**:
| 测试场景 | 输入数据 | 预期结果 |
|---------|----------|----------|
| 无效Token | 错误的token字符串 | 显示认证失败错误 |
| 无效仓库URL | 不存在的仓库地址 | 显示仓库不存在错误 |
| 网络断开 | 正确配置但无网络 | 显示网络连接错误 |
| 权限不足 | 只读权限的token | 显示权限不足错误 |

#### 1.4 多配置管理测试
**测试目标**: 验证多个平台配置的管理功能

**测试步骤**:
1. 创建3个不同平台的配置
2. 测试配置切换功能
3. 验证激活状态管理
4. 测试配置删除功能

**预期结果**:
- 支持同时存在多个配置
- 只能有一个激活配置
- 配置切换正常工作
- 删除配置不影响其他配置

---

### 2. 基础同步功能测试

#### 2.1 首次同步测试
**测试目标**: 验证初次同步到空仓库的功能

**测试步骤**:
1. 准备空的远程仓库
2. 在本地创建几个测试代码片段
3. 执行手动同步
4. 检查远程仓库内容

**预期结果**:
- 本地代码片段成功推送到远程
- 远程仓库包含正确的JSON文件
- 同步状态显示成功

#### 2.2 下行同步测试
**测试目标**: 验证从远程仓库拉取数据的功能

**测试前置条件**: 远程仓库已有代码片段数据

**测试步骤**:
1. 清空本地代码片段
2. 执行手动同步
3. 检查本地代码片段列表

**预期结果**:
- 远程数据成功下载到本地
- 代码片段正确显示在扩展中
- 目录结构保持一致

#### 2.3 上行同步测试
**测试目标**: 验证本地修改上传到远程的功能

**测试步骤**:
1. 在已同步的基础上添加新代码片段
2. 修改现有代码片段
3. 删除部分代码片段
4. 执行手动同步
5. 检查远程仓库变化

**预期结果**:
- 新增的代码片段出现在远程
- 修改的内容得到同步
- 删除的代码片段从远程移除

#### 2.4 双向同步测试
**测试目标**: 验证同时有本地和远程修改时的同步行为

**测试步骤**:
1. 设备A：添加代码片段A，同步
2. 设备B：添加代码片段B，不同步
3. 设备A：添加代码片段C，同步
4. 设备B：执行同步
5. 检查两设备的代码片段列表

**预期结果**:
- 设备B获得代码片段A和C
- 设备B的代码片段B成功上传
- 两设备数据保持一致

---

### 3. 自动同步功能测试

#### 3.1 自动同步配置测试
**测试目标**: 验证自动同步的配置功能

**测试步骤**:
1. 启用自动同步功能
2. 设置同步间隔为1分钟
3. 等待自动同步触发
4. 检查同步日志

**预期结果**:
- 自动同步按设定间隔执行
- 同步状态实时更新
- 日志记录同步活动

#### 3.2 数据变更触发同步测试
**测试目标**: 验证数据变更时自动触发同步

**测试步骤**:
1. 启用"数据变更时同步"选项
2. 创建新代码片段
3. 观察是否自动触发同步
4. 修改代码片段内容
5. 再次观察同步行为

**预期结果**:
- 数据变更后自动触发同步
- 同步状态栏显示同步进度
- 同步完成后状态更新

#### 3.3 自动同步暂停/恢复测试
**测试目标**: 验证自动同步的暂停和恢复功能

**测试步骤**:
1. 启用自动同步
2. 暂停自动同步
3. 进行数据修改
4. 验证不触发同步
5. 恢复自动同步
6. 验证同步恢复正常

**预期结果**:
- 暂停期间不执行自动同步
- 恢复后正常执行同步
- 暂停期间的修改在恢复后同步

---

### 4. 冲突处理测试

#### 4.1 简单冲突解决测试
**测试目标**: 验证基本冲突解决功能

**测试步骤**:
1. 设备A：修改代码片段X的内容，同步
2. 设备B：修改同一代码片段X的不同部分，尝试同步
3. 观察冲突提示
4. 选择合并策略
5. 完成冲突解决

**预期结果**:
- 检测到冲突并提示用户
- 提供冲突解决选项
- 用户选择后成功解决冲突

#### 4.2 复杂冲突场景测试
**测试目标**: 验证复杂冲突情况的处理

**冲突场景**:
| 场景 | 设备A操作 | 设备B操作 | 预期处理 |
|------|-----------|-----------|----------|
| 同时新增同名片段 | 创建片段"test" | 创建片段"test" | 重命名冲突 |
| 删除vs修改 | 删除片段X | 修改片段X | 提示选择保留或删除 |
| 移动vs修改 | 移动片段到目录A | 修改片段内容 | 合并修改和移动 |
| 目录重命名冲突 | 重命名目录为"utils" | 重命名同目录为"tools" | 提示重命名冲突 |

#### 4.3 冲突解决策略测试
**测试目标**: 验证不同冲突解决策略的效果

**测试策略**:
- 保留本地：本地修改优先
- 保留远程：远程修改优先  
- 手动合并：用户手动选择内容
- 创建副本：保留两个版本

**预期结果**:
- 各策略按预期工作
- 数据不丢失
- 结果符合用户选择

---

### 5. 多设备同步测试

#### 5.1 多设备数据一致性测试
**测试目标**: 验证多设备间数据同步的一致性

**测试步骤**:
1. 在设备A上创建完整的代码片段库
2. 在设备B上首次同步
3. 在设备C上首次同步
4. 验证三台设备数据一致性

**预期结果**:
- 所有设备显示相同的代码片段
- 目录结构完全一致
- 代码片段内容准确

#### 5.2 交替修改同步测试
**测试目标**: 验证多设备交替修改的同步效果

**测试步骤**:
1. 设备A：添加片段1，同步
2. 设备B：同步获取片段1，添加片段2，同步
3. 设备C：同步获取片段1和2，添加片段3，同步
4. 设备A：同步获取所有片段
5. 验证最终一致性

**预期结果**:
- 所有设备最终包含片段1、2、3
- 同步历史正确记录
- 无数据丢失

#### 5.3 并发修改处理测试
**测试目标**: 验证同时修改时的处理机制

**测试步骤**:
1. 设备A和B同时离线修改
2. 设备A先同步
3. 设备B后同步
4. 观察冲突处理
5. 验证最终结果

**预期结果**:
- 正确检测并发修改
- 合理的冲突解决流程
- 数据完整性保持

---

### 6. 错误处理和恢复测试

#### 6.1 网络异常处理测试
**测试目标**: 验证网络问题时的错误处理

**测试场景**:
| 网络状态 | 操作 | 预期行为 |
|----------|------|----------|
| 完全断网 | 执行同步 | 显示网络错误，不破坏本地数据 |
| 网络不稳定 | 执行同步 | 自动重试，显示进度 |
| 同步中断网 | 同步进行中断网 | 安全中止，数据回滚 |

#### 6.2 权限异常处理测试
**测试目标**: 验证权限问题的处理

**测试步骤**:
1. 使用只读权限的token
2. 尝试推送修改
3. 观察错误处理
4. 更换正确权限的token
5. 重新同步

**预期结果**:
- 清晰的权限错误提示
- 不破坏现有数据
- 更换token后正常工作

#### 6.3 数据损坏恢复测试
**测试目标**: 验证数据损坏时的恢复能力

**测试步骤**:
1. 人为损坏远程仓库数据
2. 执行同步操作
3. 观察错误处理和恢复提示
4. 执行数据恢复操作

**预期结果**:
- 检测到数据损坏
- 提供恢复选项
- 能够从备份恢复数据

---

### 7. 性能测试

#### 7.1 大数据量同步测试
**测试目标**: 验证大量代码片段的同步性能

**测试数据**:
- 1000个代码片段
- 100个目录
- 多层级嵌套结构

**测试指标**:
- 同步时间 < 2分钟
- 内存使用 < 200MB
- 进度显示正常

#### 7.2 频繁同步测试
**测试目标**: 验证频繁同步的稳定性

**测试步骤**:
1. 设置1分钟自动同步
2. 持续运行2小时
3. 监控性能指标
4. 检查数据一致性

**预期结果**:
- 无内存泄漏
- 性能稳定
- 数据保持一致

---

### 8. 平台兼容性测试

#### 8.1 GitHub平台测试
**特殊测试项**:
- GitHub API限制处理
- 大文件支持
- 私有仓库访问

#### 8.2 GitLab平台测试
**特殊测试项**:
- GitLab CE/EE兼容性
- 自建实例支持
- 组织权限处理

#### 8.3 Gitee平台测试
**特殊测试项**:
- 中文内容支持
- 审核机制适配
- 访问速度优化

---

## 测试执行指南

### 测试前准备
1. 备份现有代码片段数据
2. 准备测试环境和账号
3. 清理扩展状态
4. 记录初始状态

### 测试执行流程
1. 按测试分类顺序执行
2. 记录每个测试的结果
3. 对失败用例进行重试
4. 记录错误日志和截图

### 测试结果记录
```markdown
### 测试结果记录表

| 测试用例ID | 测试名称 | 执行状态 | 结果 | 备注 |
|-----------|----------|----------|------|------|
| 1.1 | 新建平台配置测试 | ✅ | 通过 | - |
| 1.2 | SSH认证配置测试 | ❌ | 失败 | SSH密钥路径识别问题 |
| ... | ... | ... | ... | ... |
```

### 风险评估

#### 高风险项
- 数据丢失风险：多设备冲突处理
- 性能风险：大数据量同步
- 安全风险：认证信息泄露

#### 风险缓解措施
- 数据备份：测试前必须备份
- 渐进测试：从小数据量开始
- 独立环境：使用测试专用账号

---

## 测试通过标准

### 功能完整性
- 所有基础功能正常工作
- 错误处理机制有效
- 用户体验流畅

### 数据安全性
- 无数据丢失情况
- 冲突解决正确
- 备份恢复可靠

### 性能稳定性
- 响应时间合理
- 资源使用正常
- 长期运行稳定

### 兼容性
- 多平台支持完整
- 认证方式可靠
- 网络环境适应性强

---

## 附录

### 常见问题排查
1. **同步失败**: 检查网络、权限、配置
2. **数据不一致**: 验证冲突解决流程
3. **性能问题**: 检查数据量和网络状况
4. **认证问题**: 验证token有效性和权限

### 测试工具推荐
- 网络监控：Wireshark
- 性能分析：VSCode内置性能工具
- 日志分析：扩展输出面板
- 数据验证：JSON格式验证工具 